<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; }
        .tab-content { margin-top: 20px; }
        .modal-body .form-group { margin-bottom: 15px; }
        table { width: 100%; }
        th, td { text-align: left; padding: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert-container">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category if category in ['success', 'danger', 'warning', 'info'] else 'info' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Tabs -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link {{ 'active' if active_tab == 'students' else '' }}" href="{{ url_for('students') }}">Students</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ 'active' if active_tab == 'parents' else '' }}" href="{{ url_for('parents') }}">Parents</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ 'active' if active_tab == 'teachers' else '' }}" href="{{ url_for('teachers') }}">Teachers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ 'active' if active_tab == 'tuition' else '' }}" href="{{ url_for('tuition') }}">Tuition</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            {% if active_tab == 'students' %}
                <!-- Students Tab -->
                <h2>Students</h2>
                <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addStudentModal">Add Student</button>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Grade</th>
                            <th>Parent</th>
                            <th>Medicines</th>
                            <th>Allergies</th>
                            <th>Medical Conditions</th>
                            <th>Comments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in students %}
                            <tr>
                                <td>{{ student.first_name }}</td>
                                <td>{{ student.last_name }}</td>
                                <td>{{ student.grade_level | upper }}</td>
                                <td>{{ student.parent_first_name }} {{ student.parent_last_name }}</td>
                                <td>{{ student.medicines or 'N/A' }}</td>
                                <td>{{ student.allergies or 'N/A' }}</td>
                                <td>{{ student.medical_conditions or 'N/A' }}</td>
                                <td>{{ student.comments or 'N/A' }}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning edit-student" data-bs-toggle="modal" data-bs-target="#editStudentModal"
                                            data-student-id="{{ student.student_id }}"
                                            data-first-name="{{ student.first_name }}"
                                            data-last-name="{{ student.last_name }}"
                                            data-grade-level="{{ student.grade_level }}"
                                            data-parent-id="{{ student.parent_id }}"
                                            data-medicines="{{ student.medicines }}"
                                            data-allergies="{{ student.allergies }}"
                                            data-medical-conditions="{{ student.medical_conditions }}"
                                            data-comments="{{ student.comments }}">Edit</button>
                                    <form action="{{ url_for('delete_student', student_id=student.student_id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this student?')">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Add Student Modal -->
                <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addStudentModalLabel">Add Student</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('add_student') }}" method="POST">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="first_name">First Name</label>
                                        <input type="text" class="form-control" id="first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name">Last Name</label>
                                        <input type="text" class="form-control" id="last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="grade_level">Grade Level</label>
                                        <select class="form-control" id="grade_level" name="grade_level" required>
                                            <option value="k">K</option>
                                            {% for i in range(1, 13) %}
                                                <option value="{{ i }}">{{ i }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="parent_id">Parent</label>
                                        <select class="form-control" id="parent_id" name="parent_id">
                                            <option value="">None</option>
                                            {% for parent in parents %}
                                                <option value="{{ parent.parent_id }}">{{ parent.first_name }} {{ parent.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="medicines">Medicines</label>
                                        <input type="text" class="form-control" id="medicines" name="medicines">
                                    </div>
                                    <div class="form-group">
                                        <label for="allergies">Allergies</label>
                                        <input type="text" class="form-control" id="allergies" name="allergies">
                                    </div>
                                    <div class="form-group">
                                        <label for="medical_conditions">Medical Conditions</label>
                                        <input type="text" class="form-control" id="medical_conditions" name="medical_conditions">
                                    </div>
                                    <div class="form-group">
                                        <label for="comments">Comments</label>
                                        <textarea class="form-control" id="comments" name="comments"></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Add Student</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Edit Student Modal -->
                <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editStudentModalLabel">Edit Student</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('edit_student') }}" method="POST">
                                <div class="modal-body">
                                    <input type="hidden" id="edit_student_id" name="student_id">
                                    <div class="form-group">
                                        <label for="edit_first_name">First Name</label>
                                        <input type="text" class="form-control" id="edit_first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_last_name">Last Name</label>
                                        <input type="text" class="form-control" id="edit_last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_grade_level">Grade Level</label>
                                        <select class="form-control" id="edit_grade_level" name="grade_level" required>
                                            <option value="k">K</option>
                                            {% for i in range(1, 13) %}
                                                <option value="{{ i }}">{{ i }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_parent_id">Parent</label>
                                        <select class="form-control" id="edit_parent_id" name="parent_id">
                                            <option value="">None</option>
                                            {% for parent in parents %}
                                                <option value="{{ parent.parent_id }}">{{ parent.first_name }} {{ parent.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_medicines">Medicines</label>
                                        <input type="text" class="form-control" id="edit_medicines" name="medicines">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_allergies">Allergies</label>
                                        <input type="text" class="form-control" id="edit_allergies" name="allergies">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_medical_conditions">Medical Conditions</label>
                                        <input type="text" class="form-control" id="edit_medical_conditions" name="medical_conditions">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_comments">Comments</label>
                                        <textarea class="form-control" id="edit_comments" name="comments"></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            {% elif active_tab == 'parents' %}
                <!-- Parents Tab -->
                <h2>Parents</h2>
                <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addParentModal">Add Parent</button>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Staff</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for parent in parents %}
                            <tr>
                                <td>{{ parent.first_name }}</td>
                                <td>{{ parent.last_name }}</td>
                                <td>{{ parent.email or 'N/A' }}</td>
                                <td>{{ parent.phone | format_phone or 'N/A' }}</td>
                                <td>{{ 'Yes' if parent.is_staff else 'No' }}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning edit-parent" data-bs-toggle="modal" data-bs-target="#editParentModal"
                                            data-parent-id="{{ parent.parent_id }}"
                                            data-first-name="{{ parent.first_name }}"
                                            data-last-name="{{ parent.last_name }}"
                                            data-email="{{ parent.email }}"
                                            data-phone="{{ parent.phone }}"
                                            data-is-staff="{{ 'true' if parent.is_staff else 'false' }}">Edit</button>
                                    <form action="{{ url_for('delete_parent', parent_id=parent.parent_id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this parent?')">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Add Parent Modal -->
                <div class="modal fade" id="addParentModal" tabindex="-1" aria-labelledby="addParentModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addParentModalLabel">Add Parent</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('add_parent') }}" method="POST">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="first_name">First Name</label>
                                        <input type="text" class="form-control" id="first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name">Last Name</label>
                                        <input type="text" class="form-control" id="last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" class="form-control" id="email" name="email">
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Phone</label>
                                        <input type="text" class="form-control" id="phone" name="phone">
                                    </div>
                                    <div class="form-group">
                                        <label for="is_staff">Is Staff</label>
                                        <input type="checkbox" id="is_staff" name="is_staff">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Add Parent</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Edit Parent Modal -->
                <div class="modal fade" id="editParentModal" tabindex="-1" aria-labelledby="editParentModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editParentModalLabel">Edit Parent</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('edit_parent') }}" method="POST">
                                <div class="modal-body">
                                    <input type="hidden" id="edit_parent_id" name="parent_id">
                                    <div class="form-group">
                                        <label for="edit_first_name">First Name</label>
                                        <input type="text" class="form-control" id="edit_first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_last_name">Last Name</label>
                                        <input type="text" class="form-control" id="edit_last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_email">Email</label>
                                        <input type="email" class="form-control" id="edit_email" name="email">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_phone">Phone</label>
                                        <input type="text" class="form-control" id="edit_phone" name="phone">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_is_staff">Is Staff</label>
                                        <input type="checkbox" id="edit_is_staff" name="is_staff">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            {% elif active_tab == 'teachers' %}
                <!-- Teachers Tab -->
                <h2>Teachers</h2>
                <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addTeacherModal">Add Teacher</button>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for teacher in teachers %}
                            <tr>
                                <td>{{ teacher.first_name }}</td>
                                <td>{{ teacher.last_name }}</td>
                                <td>{{ teacher.email or 'N/A' }}</td>
                                <td>{{ teacher.phone | format_phone or 'N/A' }}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning edit-teacher" data-bs-toggle="modal" data-bs-target="#editTeacherModal"
                                            data-teacher-id="{{ teacher.teacher_id }}"
                                            data-first-name="{{ teacher.first_name }}"
                                            data-last-name="{{ teacher.last_name }}"
                                            data-email="{{ teacher.email }}"
                                            data-phone="{{ teacher.phone }}">Edit</button>
                                    <form action="{{ url_for('delete_teacher', teacher_id=teacher.teacher_id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this teacher?')">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Add Teacher Modal -->
                <div class="modal fade" id="addTeacherModal" tabindex="-1" aria-labelledby="addTeacherModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addTeacherModalLabel">Add Teacher</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('add_teacher') }}" method="POST">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="first_name">First Name</label>
                                        <input type="text" class="form-control" id="first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name">Last Name</label>
                                        <input type="text" class="form-control" id="last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" class="form-control" id="email" name="email" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Phone</label>
                                        <input type="text" class="form-control" id="phone" name="phone" required>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Add Teacher</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Edit Teacher Modal -->
                <div class="modal fade" id="editTeacherModal" tabindex="-1" aria-labelledby="editTeacherModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editTeacherModalLabel">Edit Teacher</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{{ url_for('edit_teacher') }}" method="POST">
                                <div class="modal-body">
                                    <input type="hidden" id="edit_teacher_id" name="teacher_id">
                                    <div class="form-group">
                                        <label for="edit_first_name">First Name</label>
                                        <input type="text" class="form-control" id="edit_first_name" name="first_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_last_name">Last Name</label>
                                        <input type="text" class="form-control" id="edit_last_name" name="last_name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_email">Email</label>
                                        <input type="email" class="form-control" id="edit_email" name="email">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit_phone">Phone</label>
                                        <input type="text" class="form-control" id="edit_phone" name="phone">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            {% elif active_tab == 'tuition' %}
                <!-- Tuition Tab -->
                <h2>Tuition</h2>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Parent</th>
                            <th>Grade</th>
                            <th>Days</th>
                            <th>Total Amount</th>
                            <th>Paid in Full</th>
                            <th>Sibling Discount</th>
                            <th>Staff Discount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in tuition %}
                            <tr>
                                <td>{{ t.student_name }}</td>
                                <td>{{ t.parent_name }}</td>
                                <td>{{ t.grade }}</td>
                                <td>{{ t.days | tojson }}</td>
                                <td>${{ t.total_amount }}</td>
                                <td>{{ 'Yes' if t.paid_in_full else 'No' }}</td>
                                <td>{{ 'Yes' if t.has_sibling_discount else 'No' }}</td>
                                <td>{{ 'Yes' if t.is_staff else 'No' }}</td>
                                <td>
                                    <a href="{{ url_for('edit_tuition', tuition_id=t.tuition_id) }}" class="btn btn-sm btn-warning">Edit</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Edit Tuition Modal -->
                {% if tuition_edit %}
                    <div class="modal fade" id="editTuitionModal" tabindex="-1" aria-labelledby="editTuitionModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editTuitionModalLabel">Edit Tuition for {{ tuition_edit.student_name }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form action="{{ url_for('update_tuition') }}" method="POST">
                                    <div class="modal-body">
                                        <input type="hidden" name="tuition_id" value="{{ tuition_edit.tuition_id }}">
                                        <div class="form-group">
                                            <label for="grade">Grade</label>
                                            <select class="form-control" id="grade" name="grade" required>
                                                <option value="K" {{ 'selected' if tuition_edit.grade == 'K' }}>K</option>
                                                {% for i in range(1, 13) %}
                                                    <option value="{{ i }}" {{ 'selected' if tuition_edit.grade == i|string }}">{{ i }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Days</label>
                                            <div class="row">
                                                {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'] %}
                                                    <div class="col">
                                                        <label for="{{ day | lower }}">{{ day }}</label>
                                                        <select class="form-control day-select" id="{{ day | lower }}" name="{{ day | lower }}">
                                                            <option value="">None</option>
                                                            {% if tuition_edit.grade == 'K' %}
                                                                <option value="morning" {{ 'selected' if tuition_edit.days[day] == 'morning' }}>Morning</option>
                                                                <option value="afternoon" {{ 'selected' if tuition_edit.days[day] == 'afternoon' }}>Afternoon</option>
                                                            {% else %}
                                                                <option value="full" {{ 'selected' if tuition_edit.days[day] == 'full' }}>Full</option>
                                                                <option value="enrichment" {{ 'selected' if tuition_edit.days[day] == 'enrichment' }}>Enrichment</option>
                                                                <option value="academic" {{ 'selected' if tuition_edit.days[day] == 'academic' }}>Academic</option>
                                                            {% endif %}
                                                        </select>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="paid_in_full">Paid in Full</label>
                                            <input type="checkbox" id="paid_in_full" name="paid_in_full" {{ 'checked' if tuition_edit.paid_in_full }}>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Edit Student Modal
        document.querySelectorAll('.edit-student').forEach(button => {
            button.addEventListener('click', function() {
                const modal = document.querySelector('#editStudentModal');
                modal.querySelector('#edit_student_id').value = this.dataset.studentId;
                modal.querySelector('#edit_first_name').value = this.dataset.firstName;
                modal.querySelector('#edit_last_name').value = this.dataset.lastName;
                modal.querySelector('#edit_grade_level').value = this.dataset.gradeLevel;
                modal.querySelector('#edit_parent_id').value = this.dataset.parentId || '';
                modal.querySelector('#edit_medicines').value = this.dataset.medicines || '';
                modal.querySelector('#edit_allergies').value = this.dataset.allergies || '';
                modal.querySelector('#edit_medical_conditions').value = this.dataset.medicalConditions || '';
                modal.querySelector('#edit_comments').value = this.dataset.comments || '';
            });
        });

        // Edit Parent Modal
        document.querySelectorAll('.edit-parent').forEach(button => {
            button.addEventListener('click', function() {
                const modal = document.querySelector('#editParentModal');
                modal.querySelector('#edit_parent_id').value = this.dataset.parentId;
                modal.querySelector('#edit_first_name').value = this.dataset.firstName;
                modal.querySelector('#edit_last_name').value = this.dataset.lastName;
                modal.querySelector('#edit_email').value = this.dataset.email || '';
                modal.querySelector('#edit_phone').value = this.dataset.phone || '';
                modal.querySelector('#edit_is_staff').checked = this.dataset.isStaff === 'true';
            });
        });

        // Edit Teacher Modal
        document.querySelectorAll('.edit-teacher').forEach(button => {
            button.addEventListener('click', function() {
                const modal = document.querySelector('#editTeacherModal');
                modal.querySelector('#edit_teacher_id').value = this.dataset.teacherId;
                modal.querySelector('#edit_first_name').value = this.dataset.firstName;
                modal.querySelector('#edit_last_name').value = this.dataset.lastName;
                modal.querySelector('#edit_email').value = this.dataset.email || '';
                modal.querySelector('#edit_phone').value = this.dataset.phone || '';
            });
        });

        // Tuition Modal Auto-Show
        {% if tuition_edit %}
            const editTuitionModal = new bootstrap.Modal(document.getElementById('editTuitionModal'));
            editTuitionModal.show();
            document.getElementById('grade').addEventListener('change', function() {
                const grade = this.value;
                const daySelects = document.querySelectorAll('.day-select');
                daySelects.forEach(select => {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">None</option>';
                    if (grade === 'K') {
                        select.innerHTML += '<option value="morning">Morning</option><option value="afternoon">Afternoon</option>';
                    } else {
                        select.innerHTML += '<option value="full">Full</option><option value="enrichment">Enrichment</option><option value="academic">Academic</option>';
                    }
                    select.value = currentValue && select.querySelector(`option[value="${currentValue}"]`) ? currentValue : '';
                });
            });
        {% endif %}
    </script>
</body>
</html>